<!DOCTYPE html>
<html lang="no">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‚ûï Legg til ny butikk</title>
  <link rel="stylesheet" href="/assets/css/theme-t√∏ff.css" />
  <style>
    body {
      font-family: sans-serif;
      padding: 2rem;
    }

    label {
      font-weight: bold;
      margin-top: 1rem;
      display: block;
    }

    input,
    textarea,
    select {
      width: 100%;
      padding: 0.5rem;
      margin-bottom: 1rem;
    }

    #jsonResult {
      background: #fafafa;
      padding: 1rem;
      border: 1px solid #eee;
      margin-top: 2rem;
    }

    .smaller {
      font-size: 0.9em;
      color: #888;
    }

    button {
      padding: 0.7rem 1.5rem;
    }

    .tag-list {
      margin: 0 0 1em 0;
      padding: 0;
      list-style: none;
    }

    .tag-list li {
      display: inline-block;
      background: #e6f3ff;
      border-radius: 8px;
      padding: 2px 10px;
      margin: 2px 5px 2px 0;
      font-size: 0.9em;
    }
  </style>
</head>

<body>
  <h1>‚ûï Legg til ny butikk</h1>
  <form id="butikkForm" autocomplete="off">
    <label for="name">Butikknavn</label>
    <input id="name" placeholder="F.eks. Trademax" required />

    <label for="url">Nettadresse (URL)</label>
    <input id="url" placeholder="https://www.trademax.no/" required />

    <button type="button" onclick="hentBeskrivelse()">üîç Hent beskrivelse</button>

    <label for="category">Kategori</label>
    <select id="category" required onchange="oppdaterUnderkategorier()">
      <option value="">Velg kategori</option>
      <option>Elektronikk og data</option>
      <option>Kl√¶r og mote</option>
      <option>M√∏bler og interi√∏r</option>
      <option>Sport og friluftsliv</option>
      <option>Helse og egenpleie</option>
      <option>Barn og baby</option>
      <option>Underholdning og popkultur</option>
      <option>Alt-mulig butikker</option>
      <option>Gaver og gadgets</option>
      <option>Mat og drikke</option>
      <option>Hobby og DIY</option>
      <option>B√∏ker og media</option>
      <option>Dyrebutikker</option>
      <option>Print og foto</option>
      <option>Kreative tjenester</option>
    </select>

    <label for="subcategory">Underkategori(er) <span class="smaller">(hold Ctrl/Cmd for √• velge flere)</span></label>
    <select id="subcategory" multiple size="4"></select>

    <label for="tags">Ekstra tags <span class="smaller">(komma-separert, frivillig)</span></label>
    <input id="tags" placeholder="F.eks. sofa, hjemmem√∏bler, design" />

    <label for="description">Beskrivelse</label>
    <textarea id="description" rows="4" placeholder="Skriv en beskrivelse her"></textarea>

    <button type="submit">üíæ Generer JSON</button>
  </form>

  <h2>üóÇÔ∏è Forsl√•tte tags</h2>
  <ul id="autoTags" class="tag-list"></ul>

  <h2>üìã JSON-resultat</h2>
  <pre id="jsonResult"></pre>

  <script>
    // Underkategori-mapping (minimumseksempler ‚Äì legg til etter behov!)
    const underkatMap = {
      "Elektronikk og data": ["Elektronikk", "Gamingutstyr", "Lyd og bilde", "Mobil og nettbrett", "PC og tilbeh√∏r"],
      "Kl√¶r og mote": ["Damekl√¶r", "Herrekl√¶r", "Barnekl√¶r", "Sko og tilbeh√∏r", "Sportskl√¶r"],
      "M√∏bler og interi√∏r": ["M√∏bler", "Belysning", "Dekor og interi√∏r"],
      "Sport og friluftsliv": ["Treningskl√¶r", "Friluft og tur", "Sykkel og sykkelutstyr", "Treningsutstyr", "Sportskl√¶r"],
      "Helse og egenpleie": ["Apotek og helseprodukter", "Hud- og kroppspleie", "Sminke og kosmetikk", "Trening og velv√¶re"],
      "Barn og baby": ["Babyutstyr", "Leker"],
      "Underholdning og popkultur": ["Anime og manga", "Figurer og samleobjekter", "Brettspill og kortspill", "Film og musikk", "Digitale spilln√∏kler", "Konsoller"],
      "Alt-mulig butikker": ["Gadgets og tilbeh√∏r", "Grossist og dropshipping", "Kles- og livsstilsbutikker"],
      "Gaver og gadgets": ["Gadgets og gaver"],
      "Mat og drikke": ["Dagligvarer", "Frokost og levering", "Matkasser", "Vin og bartilbeh√∏r"],
      "Hobby og DIY": ["DIY kits og prosjekter", "Garn og strikk", "Kunst og tegneutstyr", "Radiostyrte produkter"],
      "B√∏ker og media": ["Barneb√∏ker", "B√∏ker og e-b√∏ker", "Lyd- og lydb√∏ker", "Fagb√∏ker"],
      "Dyrebutikker": ["Hund", "Katt", "Sm√•dyr", "Fugl", "Fisk", "Hest", "Reptil og terrarie", "F√¥r og ern√¶ring", "Hundekl√¶r", "Katteklor og m√∏bler", "Akvarieutstyr"],
      "Print og foto": ["Fotob√∏ker", "Fremkalling", "Plakater og print-on-demand", "Fotoutstyr", "Kameradroner"],
      "Kreative tjenester": ["Design og logo", "Tegneserier og manga", "AI-tjenester", "Illustrasjon og kunst", "Merch og t-skjorter"]
    };

    // Tag-mal for autogenerering (minimumseksempler ‚Äì utvid etter behov!)
    const tagMal = {
      // Kl√¶r og mote
          "Damekl√¶r": ["damekl√¶r", "fashion", "mote", "outfit", "stil", "komfort"],
          "Herrekl√¶r": ["herrekl√¶r", "herremote", "outfit", "casual", "formelt"],
          "Barnekl√¶r": ["barnekl√¶r", "barnemote", "kl√¶r til barn", "komfort", "sm√•barnskl√¶r"],
          "Sko og tilbeh√∏r": ["sko", "sandaler", "boots", "sneakers", "vesker", "belte", "solbriller", "tilbeh√∏r", "h√•rpynt", "hansker"],
          "Sportskl√¶r": ["treningskl√¶r", "l√∏pekl√¶r", "yogat√∏y", "funksjonst√∏y", "aktiv livsstil", "idrettskl√¶r"],

          // Barn og baby
          "Babyutstyr": ["baby", "smokk", "flaske", "bleier", "stelleveske", "vogn", "barnesete", "amme", "babyshower"],
          "Leker": ["leker", "leket√∏y", "spill", "puslespill", "pedagogisk", "kreativ lek", "bamse", "dukker", "lego"],

          // B√∏ker og media
          "B√∏ker": ["b√∏ker", "romaner", "litteratur", "papirbok", "klassikere", "bokhandel"],
          "E-b√∏ker": ["e-bok", "digital bok", "kindle", "pdf-bok", "elektronisk", "lesebrett"],
          "Fagb√∏ker": ["fagb√∏ker", "studier", "utdanning", "l√¶rebok", "akademisk", "pensum"],
          "Lyd- og lydb√∏ker": ["lydb√∏ker", "audiobok", "lyttebok", "opplesning", "fortelling"],

          // Digitale tjenester
          "Mobilabonnement": ["mobil", "mobilabonnement", "data", "4G", "5G", "telefoni", "SIM-kort"],
          "Nettkurs": ["nettkurs", "e-l√¶ring", "utdanning", "kompetanse", "kurs", "online l√¶ring"],
          "Str√∏mleverand√∏rer": ["str√∏m", "str√∏mleverand√∏r", "str√∏mavtale", "spotpris", "energileverand√∏r"],
          "Str√∏mmetjenester": ["str√∏mming", "filmer", "serier", "TV", "musikk", "streaming", "abonnement"],
          "Treningsapper og programmer": ["treningsapp", "online trening", "fitness", "l√∏ping", "styrketrening"],
          "VPN og Nettsikkerhet": ["VPN", "nettsikkerhet", "anonymitet", "personvern", "IP-skjuling", "kryptering"],
          "Webhosting & Domene": ["webhotell", "hosting", "domene", "nettside", "e-post", "server", "cPanel"],

          // Dyrebutikker
          "Fisk og akvarium": ["akvarium", "fisk", "fiskef√¥r", "vanntest", "akvarieutstyr", "akvariedekor"],
          "F√¥r og ern√¶ring": ["dyref√¥r", "hundemat", "kattemat", "vitaminer", "dyreern√¶ring", "kosthold"],
          "Fugl": ["fugl", "bur", "fuglefr√∏", "papeg√∏ye", "kanarifugl", "fugleleker", "voliere"],
          "Hund": ["hund", "halsb√•nd", "sele", "hundeseng", "hundeleker", "hundebur"],
          "Reptil og terrarie": ["reptil", "slange", "skilpadde", "terrarium", "varmelampe", "reptilf√¥r"],

          // Elektronikk og data
          "Elektronikk": ["elektronikk", "teknologi", "smarte enheter", "kabler", "elektriske produkter"],
          "Lyd og bilde": ["h√∏yttaler", "headset", "TV", "projektor", "lydanlegg", "hjemmekino"],
          "Mobil og nettbrett": ["mobil", "smarttelefon", "nettbrett", "telefondeksel", "Android", "iOS"],
          "Smarthus og kabler": ["smarthus", "sensor", "smartlys", "home automation", "str√∏mstyring"],
          "Spill og konsoller": ["spill", "konsoll", "PlayStation", "Xbox", "Nintendo", "flerspiller"],
          "Teknologinyheter": ["tech-nyheter", "gadgets", "produktomtaler", "lansering"],

          // Gaming og tilbeh√∏r
          "Brettspill": ["brettspill", "familiespill", "strategispill", "kortspill", "spillkveld"],
          "E-sportutstyr": ["e-sport", "gamingmus", "gamingtastatur", "headset", "turnering"],
          "Gaming-PC og skjermer": ["gaming-PC", "skjerm", "FPS", "grafikkort", "prosessor", "bygge PC"],
          "Gaming-tilbeh√∏r": ["spillstol", "RGB", "musmatte", "headset-holder", "gamingutstyr"],
          "Konsoller": ["PlayStation", "Xbox", "Nintendo Switch", "spillpakke", "familiespill"],
          "PC og datatilbeh√∏r": ["mus", "tastatur", "USB-hub", "webkamera", "minnepinne"],

          // Gaver og gadgets
          "Gadgets og gaver": ["gadgets", "gaver", "smarte ting", "teknologi", "gaveideer", "personlig gave", "morsomme produkter"],
          "Alt-mulig butikker": ["nettbutikk", "variert utvalg", "alt mulig", "stor katalog", "import"],
          "Utenlandske": ["internasjonal", "import", "frakt", "utenlandsk butikk", "lav pris"],

          // Helse og egenpleie
          "Hud- og kroppspleie": ["hudpleie", "kroppskrem", "dusjs√•pe", "fuktighetskrem", "naturlig hudpleie"],
          "H√•r- og skj√∏nnhetspleie": ["shampoo", "h√•rkur", "styling", "skj√∏nnhet", "h√•rpleie"],
          "Kosmetikk og sminke": ["sminke", "leppestift", "√∏yenskygge", "foundation", "makeup"],
          "Naturlige produkter": ["naturlig", "√∏kologisk", "vegansk", "b√¶rekraftig", "plantebasert"],
          "Sminke og kosmetikk": ["sminke", "kosmetikk", "foundation", "makeup", "√∏yne"],
          "Trening og velv√¶re": ["trening", "kosttilskudd", "velv√¶re", "yoga", "balanse", "energi"],

          // Hobby og DIY
          "DIY kits og prosjekter": ["DIY", "byggesett", "lim", "oppskrifter", "perler", "prosjekt", "hobby", "h√•ndverk"],
          "Garn og strikk": ["strikking", "garn", "hekling", "oppskrifter", "pinner", "ull", "h√•ndarbeid"],
          "Kunst og tegneutstyr": ["tegning", "maling", "akvarell", "blyanter", "skissebok", "kunstnerutstyr"],
          "Radiostyrte produkter": ["RC", "radiostyrt", "bil", "b√•t", "drone", "motor", "modellbygging"],

          // Mat og drikke
          "Dagligvarer": ["dagligvarer", "p√•legg", "kaffe", "frossenmat", "√∏kologisk mat"],
          "Frokost og levering": ["frokost", "br√∏d", "morgenmat", "matlevering", "rask levering"],
          "Matkasser": ["matkasse", "oppskrifter", "middag", "levering", "familievennlig"],
          "Vin og bartilbeh√∏r": ["vin", "vinkj√∏ler", "glass", "bartilbeh√∏r", "drinktilbeh√∏r"],
          "Vin og brennevin": ["brennevin", "whisky", "cocktail", "smaking", "alkohol"],

          // M√∏bler og interi√∏r
          "Belysning": ["lamper", "lys", "p√¶rer", "taklampe", "stemningsbelysning"],
          "Dekor og interi√∏r": ["interi√∏r", "dekor", "bilder", "pynt", "tepper", "nordisk design"],
          "M√∏bler": ["sofa", "bord", "stoler", "seng", "oppbevaring", "skandinavisk stil"],

          // Reise og opplevelser
          "Bager og kofferter": ["koffert", "bag", "reiseveske", "bagasje", "trillebag"],
          "Kart og guider": ["reiseguider", "kart", "turkart", "guidebok", "destinasjon"],
          "Reiseutstyr": ["reiseadapter", "nakkepute", "toalettmappe", "organisering", "reiseutstyr"],
          "Tur- og friluftsutstyr": ["friluft", "tur", "ryggsekk", "sovepose", "telt", "villmark"],

          // Sport og fritid
          "Friluft og tur": ["friluft", "tur", "sovepose", "villmark", "fjell", "telt", "utend√∏rs"],
          "Treningskl√¶r": ["treningskl√¶r", "tight", "sports-bh", "aktiv livsstil", "funksjonst√∏y"],
          "Sykkel og sykkelutstyr": ["sykkel", "sykkelhjelm", "elsykkel", "sykkellykt", "verkt√∏y"],
          "Sportskl√¶r": ["l√∏pekl√¶r", "sportst√∏y", "aktivitetskl√¶r", "yogat√∏y", "funksjonskl√¶r"],
          "Treningsutstyr": ["manualer", "treningsmatte", "styrketrening", "strikk", "apparat"],

          // Underholdning og popkultur
          "Anime og manga": ["anime", "manga", "figurer", "otaku", "cosplay", "fanartikler"],
          "Digitale spilln√∏kler": ["spilln√∏kkel", "Steam", "PC-spill", "nedlasting", "rabattkode"],
          "Figurer og samleobjekter": ["samleobjekter", "figurer", "merch", "POP!", "statuetter"],
          "Film og musikk": ["DVD", "blu-ray", "vinyl", "CD", "filmkveld", "platebutikk"]
        };
        // Oppdaterer alle butikker med tags basert p√• underkategori

    function oppdaterUnderkategorier() {
      const kat = document.getElementById("category").value;
      const subSelect = document.getElementById("subcategory");
      subSelect.innerHTML = ""; // T√∏m
      if (kat && underkatMap[kat]) {
        underkatMap[kat].forEach(u => {
          const opt = document.createElement("option");
          opt.value = u;
          opt.textContent = u;
          subSelect.appendChild(opt);
        });
      }
      visAutoTags(); // Oppdater automatisk n√•r kategori endres
    }

    function visAutoTags() {
      const subSelect = document.getElementById("subcategory");
      const ul = document.getElementById("autoTags");
      ul.innerHTML = "";
      let tags = [];
      for (const opt of subSelect.selectedOptions) {
        if (tagMal[opt.value]) {
          tags.push(...tagMal[opt.value]);
        }
      }
      tags = [...new Set(tags)]; // Unik liste
      tags.forEach(tag => {
        const li = document.createElement("li");
        li.textContent = tag;
        ul.appendChild(li);
      });
    }
    document.getElementById("subcategory").addEventListener("change", visAutoTags);

    async function hentBeskrivelse() {
      const url = document.getElementById("url").value;
      if (!url) return alert("Skriv inn butikkens URL f√∏rst.");
      try {
        const res = await fetch("http://127.0.0.1:5000/api/meta?url=" + encodeURIComponent(url));
        const data = await res.json();
        if (data.description) {
          document.getElementById("description").value = data.description;
        } else if (data.error) {
          alert("Feil fra server: " + data.error);
        } else {
          alert("Fant ingen beskrivelse.");
        }
      } catch (err) {
        alert("Kunne ikke hente beskrivelse fra serveren.");
        console.error(err);
      }
    }

    document.getElementById("butikkForm").addEventListener("submit", e => {
      e.preventDefault();
      // Hent verdier
      const name = document.getElementById("name").value.trim();
      const url = document.getElementById("url").value.trim();
      const category = document.getElementById("category").value.trim();

      // Samle alle valgte underkategorier
      const subcats = [];
      for (const opt of document.getElementById("subcategory").selectedOptions) {
        subcats.push(opt.value);
      }
      const description = document.getElementById("description").value.trim();

      // Tags: autogenererte fra tagMal + ekstra fra input
      let tags = [];
      subcats.forEach(uk => {
        if (tagMal[uk]) tags.push(...tagMal[uk]);
      });
      const extraTags = document.getElementById("tags").value.split(",").map(t => t.trim()).filter(Boolean);
      tags = [...new Set([...tags, ...extraTags])];

      // Generer image-path (slugify)
      const slug = name
        .toLowerCase()
        .replace(/√•/g, 'a').replace(/√∏/g, 'o').replace(/√¶/g, 'ae')
        .replace(/[^a-z0-9]+/g, "-")
        .replace(/^-+|-+$/g, "");
      const imagePath = `assets/images/butikker-webp/${slug}.webp`;

      // Lag JSON-objekt
      const butikkObj = {
        "name": name,
        "image": imagePath,
        "alt": name,
        "category": category,
        "subcategory": subcats,
        "url": url,
        "description": description,
        "topp25": false,
        "forside": false,
        "ny": true,
        "annonse": true,
        "tags": tags,
        "partner": false,
        "affiliate": true,
        "affiliateUrl": "",
        "kampanje": false,
        "ukensAnbefalte": "",
        "rank": null
      };

      document.getElementById("jsonResult").textContent = JSON.stringify(butikkObj, null, 2);
    });

    // F√∏rste last, init underkategori hvis valgt kategori
    document.addEventListener("DOMContentLoaded", oppdaterUnderkategorier);
  </script>
</body>

</html>